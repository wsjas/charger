<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>XCharger | Factory</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />

  <style>
    :root{
      --bg:#f5f7fa;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#64748b;
      --primary:#1677ff;
      --primary2:#00d2d3;
      --line:rgba(15,23,42,.08);
      --shadow:0 18px 60px rgba(2,8,23,.10);
      --radius:18px;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;font-family:"Cairo",system-ui,-apple-system,Segoe UI,Arial; background:var(--bg); color:var(--text);}
    a{color:inherit}
    .container{width:min(1150px,92vw); margin:0 auto;}
    header{
      position:fixed; inset-inline:0; top:0; z-index:50;
      background:rgba(255,255,255,.82);
      backdrop-filter: blur(14px);
      border-bottom:1px solid var(--line);
    }
    .nav{display:flex; align-items:center; justify-content:space-between; gap:14px; padding:12px 0;}
    .brand{display:flex; align-items:center; gap:10px; font-weight:900; letter-spacing:.2px; text-decoration:none;}
    .brand i{color:var(--primary)}
    .brand span{color:var(--primary)}
    .menu{display:flex; align-items:center; gap:14px; flex-wrap:wrap}
    .menu a{text-decoration:none; font-weight:800; color:var(--text); opacity:.85; padding:8px 10px; border-radius:12px}
    .menu a:hover{background:rgba(2,8,23,.04); opacity:1}
    .actions{display:flex; align-items:center; gap:10px; flex-wrap:wrap}
    .pill{display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:999px; border:1px solid var(--line); background:rgba(255,255,255,.9); font-weight:900;}
    .btn{border:0; cursor:pointer; font-weight:900; border-radius:999px; padding:10px 14px; display:inline-flex; align-items:center; gap:9px;}
    .btn-primary{background:var(--primary); color:#fff; box-shadow:0 14px 30px rgba(22,119,255,.22)}
    .btn-primary:hover{filter:brightness(.97)}
    .btn-ghost{background:#fff; border:1px solid var(--line); color:var(--text)}
    .btn-ghost:hover{background:rgba(2,8,23,.03)}
    .chip{font-weight:900; padding:7px 10px; border-radius:999px; border:1px solid var(--line); background:#fff; cursor:pointer}
    .chip.active{background:rgba(22,119,255,.10); border-color:rgba(22,119,255,.25); color:var(--primary)}

    .hero{padding-top:86px;}
    .hero-wrap{
      margin-top:10px;
      border-radius:28px;
      overflow:hidden;
      background:
        linear-gradient(135deg, rgba(2,8,23,.78), rgba(22,119,255,.28)),
        url("https://images.unsplash.com/photo-1593941707882-a5bba14938c7?auto=format&fit=crop&w=1600&q=80") center/cover;
      box-shadow: var(--shadow);
      min-height: 420px;
      display:flex;
      align-items:center;
    }
    .hero-inner{padding:44px 22px; width:100%;}
    .hero h1{margin:0 0 10px; color:#fff; font-size:clamp(28px,4.2vw,52px); line-height:1.1; font-weight:900;}
    .hero p{margin:0 0 18px; color:rgba(255,255,255,.9); max-width:780px; font-size:clamp(14px,1.25vw,18px); font-weight:700}
    .hero-cta{display:flex; gap:10px; flex-wrap:wrap}
    .hero .btn-ghost{background:rgba(255,255,255,.10); border-color:rgba(255,255,255,.18); color:#fff}
    .hero .btn-ghost:hover{background:rgba(255,255,255,.14)}

    .stats{margin-top:-34px;}
    .stats-grid{display:grid; grid-template-columns: repeat(4,minmax(0,1fr)); gap:12px}
    .stat{background:rgba(255,255,255,.80); backdrop-filter: blur(10px); border:1px solid var(--line); border-radius:18px; padding:14px 14px; box-shadow:0 10px 30px rgba(2,8,23,.06); display:flex; align-items:center; gap:12px}
    .stat i{color:var(--primary)}
    .stat .k{font-weight:900}
    .stat .v{font-weight:900; color:var(--muted); font-size:13px}

    section{padding:54px 0}
    .title{text-align:center; margin-bottom:18px}
    .title h2{margin:0; font-size:28px; font-weight:900}
    .title p{margin:10px 0 0; color:var(--muted); font-weight:800}
    .card{background:var(--card); border:1px solid var(--line); border-radius:var(--radius); box-shadow:0 12px 38px rgba(2,8,23,.06);}
    .grid-2{display:grid; grid-template-columns: 1fr 1fr; gap:16px}

    .products{display:grid; grid-template-columns: repeat(2,minmax(0,1fr)); gap:16px; margin-top:18px}
    .p-card{padding:16px; display:flex; flex-direction:column; gap:12px}
    .p-top{display:flex; gap:12px; align-items:center}
    .p-img{width:92px; height:92px; border-radius:16px; background:#f1f5f9; border:1px solid var(--line); display:flex; align-items:center; justify-content:center; overflow:hidden}
    .p-img img{width:100%; height:100%; object-fit:cover}
    .p-name{font-weight:900; font-size:18px; margin:0}
    .p-badge{display:inline-flex; gap:8px; align-items:center; font-weight:900; color:#0b1220; background:rgba(22,119,255,.10); border:1px solid rgba(22,119,255,.20); padding:6px 10px; border-radius:999px}
    .p-price{font-weight:900; font-size:20px}
    .muted{color:var(--muted); font-weight:800}
    .feat{margin:0; padding:0; list-style:none; display:grid; gap:8px}
    .feat li{display:flex; gap:10px; align-items:flex-start; font-weight:800; color:#334155}
    .feat i{color:#16a34a; margin-top:4px}
    .p-actions{display:flex; gap:10px; flex-wrap:wrap; margin-top:8px}
    .p-actions .btn{padding:9px 12px; border-radius:14px}

    .table-wrap{overflow:auto}
    table{width:100%; border-collapse:collapse; min-width:780px}
    th,td{padding:12px 12px; border-bottom:1px solid var(--line); text-align:right; font-weight:800}
    th{background:#f8fafc; position:sticky; top:0; z-index:1}
    td small{color:var(--muted); font-weight:900}

    #adminPanel{display:none}
    .admin-grid{display:grid; grid-template-columns: 1.1fr .9fr; gap:16px; margin-top:16px}
    .admin-card{padding:16px}
    .field{display:grid; gap:7px; margin-bottom:12px}
    label{font-weight:900; color:#0b1220}
    input,textarea,select{
      width:100%;
      padding:11px 12px;
      border-radius:14px;
      border:1px solid var(--line);
      background:#fff;
      font-family:inherit;
      font-weight:800;
      outline:none;
    }
    textarea{min-height:94px; resize:vertical}
    input:focus,textarea:focus,select:focus{border-color:rgba(22,119,255,.45); box-shadow:0 0 0 4px rgba(22,119,255,.10)}
    .admin-list{display:grid; gap:10px}
    .item{display:flex; justify-content:space-between; align-items:center; gap:12px; padding:12px; border-radius:16px; border:1px solid var(--line); background:#fff}
    .item .meta{display:grid; gap:2px}
    .item .meta b{font-weight:900}
    .item .meta span{font-weight:900; color:var(--muted); font-size:12px}
    .item .row{display:flex; gap:8px; flex-wrap:wrap}
    .danger{background:#fff; border:1px solid rgba(239,68,68,.25); color:#b91c1c}

    footer{background:#0b1220; color:#cbd5e1; padding:34px 0;}
    .foot{display:grid; grid-template-columns: 1.3fr 1fr 1fr; gap:18px}
    .foot h3,.foot h4{margin:0 0 10px; color:#fff}
    .social{display:flex; gap:10px; flex-wrap:wrap}
    .iconbtn{width:40px; height:40px; border-radius:14px; border:1px solid rgba(255,255,255,.12); display:flex; align-items:center; justify-content:center; background:rgba(255,255,255,.06); text-decoration:none}

    .copy{margin-top:18px; padding-top:16px; border-top:1px solid rgba(255,255,255,.08); text-align:center; font-weight:800; color:#94a3b8}

    .modal{display:none; position:fixed; inset:0; z-index:60; background:rgba(2,8,23,.55); padding:18px}
    .modal-inner{max-width:420px; margin:80px auto 0; background:#fff; border-radius:22px; border:1px solid var(--line); box-shadow: var(--shadow); padding:18px}
    .modal-head{display:flex; justify-content:space-between; align-items:center; gap:10px}
    .modal-head h3{margin:0; font-weight:900}
    .x{border:0; background:transparent; font-size:22px; cursor:pointer}
    .hint{margin-top:12px; font-weight:900; color:#b45309; background:#fff7ed; border:1px solid rgba(180,83,9,.18); padding:10px 12px; border-radius:16px; display:none}

    @media (max-width:980px){
      .stats-grid{grid-template-columns: repeat(2,minmax(0,1fr));}
      .admin-grid{grid-template-columns: 1fr;}
      .foot{grid-template-columns:1fr;}
    }
    @media (max-width:720px){
      .products{grid-template-columns:1fr}
      .menu{display:none}
      .hero-inner{padding:34px 16px}
    }
  </style>
</head>

<body>
<header>
  <div class="container">
    <div class="nav">
      <a class="brand" href="#home"><i class="fa-solid fa-charging-station"></i> <span id="brandText">XCharger</span></a>
      <nav class="menu">
        <a href="#home" data-i18n="nav_home">الرئيسية</a>
        <a href="#products" data-i18n="nav_products">المنتجات</a>
        <a href="#compare" data-i18n="nav_compare">المقارنة</a>
        <a href="#faq" data-i18n="nav_faq">الأسئلة</a>
        <a href="#contact" data-i18n="nav_contact">اتصل بنا</a>
      </nav>
      <div class="actions">
        <div class="pill" id="userPill" style="display:none"><i class="fa-solid fa-user"></i> <span id="userText"></span></div>
        <button class="chip active" id="langAR">AR</button>
        <button class="chip" id="langEN">EN</button>
        <button class="btn btn-ghost" id="adminNavBtn" style="display:none"><i class="fa-solid fa-screwdriver-wrench"></i> <span data-i18n="admin_nav">لوحة الإدارة</span></button>
        <button class="btn btn-primary" id="loginBtn"><i class="fa-solid fa-right-to-bracket"></i> <span data-i18n="login_btn">تسجيل الدخول</span></button>
        <button class="btn btn-ghost" id="logoutBtn" style="display:none"><i class="fa-solid fa-arrow-right-from-bracket"></i> <span data-i18n="logout_btn">تسجيل خروج</span></button>
      </div>
    </div>
  </div>
</header>

<main class="hero" id="home">
  <div class="container hero-wrap">
    <div class="hero-inner">
      <h1 data-i18n="hero_title">طاقة المستقبل بين يديك</h1>
      <p data-i18n="hero_sub">نصمم وننتج شواحن ذكية تجمع بين الأمان وسهولة الاستخدام مع إصدارات متعددة تناسب احتياجاتك.</p>
      <div class="hero-cta">
        <a class="btn btn-primary" href="#products"><i class="fa-solid fa-bolt"></i> <span data-i18n="hero_cta1">اكتشف منتجاتنا</span></a>
        <a class="btn btn-ghost" href="#contact"><i class="fa-solid fa-paper-plane"></i> <span data-i18n="hero_cta2">طلب خاص</span></a>
      </div>
    </div>
  </div>

  <div class="container stats">
    <div class="stats-grid">
      <div class="stat"><i class="fa-solid fa-sliders"></i><div><div class="k" data-i18n="stat_4_title">تحكم ذكي مرن</div><div class="v" data-i18n="stat_4">تجربة استخدام سهلة</div></div></div>
      <div class="stat"><i class="fa-solid fa-shield-halved"></i><div><div class="k">100%</div><div class="v" data-i18n="stat_3">أمان واعتمادية</div></div></div>
      <div class="stat"><i class="fa-solid fa-headset"></i><div><div class="k">24/7</div><div class="v" data-i18n="stat_2">دعم فني</div></div></div>
      <div class="stat"><i class="fa-solid fa-medal"></i><div><div class="k">3</div><div class="v" data-i18n="stat_1">ضمان</div></div></div>
    </div>
  </div>
</main>

<section id="products">
  <div class="container">
    <div class="title">
      <h2 data-i18n="products_title">إصدارات XCharger المتطورة</h2>
      <p data-i18n="products_sub">تظهر المنتجات تلقائيًا من Firebase Firestore</p>
    </div>
    <div class="products" id="productsGrid"></div>
    <div class="card" style="padding:14px; margin-top:14px;">
      <div class="muted" id="productsEmpty" data-i18n="products_empty" style="text-align:center">لا يوجد منتجات بعد. سيتم عرضها هنا عند إضافتها من لوحة الإدارة.</div>
    </div>
  </div>
</section>

<section id="compare">
  <div class="container">
    <div class="title">
      <h2 data-i18n="compare_title">مقارنة الإصدارات</h2>
      <p data-i18n="compare_sub">جدول يوضح أهم الفروقات بين الإصدارات</p>
    </div>
    <div class="card table-wrap">
      <table id="compareTable"></table>
    </div>
  </div>
</section>

<section id="adminPanel">
  <div class="container">
    <div class="title">
      <h2><i class="fa-solid fa-screwdriver-wrench"></i> <span data-i18n="admin_title">لوحة تحكم المدير</span></h2>
      <p data-i18n="admin_sub">إضافة/تعديل/حذف المنتجات مباشرة على Firestore</p>
    </div>

    <div class="admin-grid">
      <div class="card admin-card">
        <h3 style="margin:0 0 12px; font-weight:900" data-i18n="admin_form_title">بيانات المنتج</h3>
        <div class="muted" style="margin-bottom:12px" data-i18n="admin_form_hint">املأ الحقول ثم اضغط حفظ.</div>

        <div class="field"><label data-i18n="f_name">اسم المنتج</label><input id="f_name" placeholder="xcharger" /></div>

        <div class="grid-2">
          <div class="field"><label data-i18n="f_price_jod_retail">سعر المفرق (JOD)</label><input id="f_price_jod_retail" type="number" min="0" step="0.01" placeholder="90" /></div>
          <div class="field"><label data-i18n="f_price_jod_trade">سعر التاجر (JOD)</label><input id="f_price_jod_trade" type="number" min="0" step="0.01" placeholder="80" /></div>
        </div>

        <div class="grid-2">
          <div class="field"><label data-i18n="f_price_usd_retail">سعر المفرق (USD)</label><input id="f_price_usd_retail" type="number" min="0" step="0.01" placeholder="130" /></div>
          <div class="field"><label data-i18n="f_price_usd_trade">سعر التاجر (USD)</label><input id="f_price_usd_trade" type="number" min="0" step="0.01" placeholder="110" /></div>
        </div>

        <div class="field"><label data-i18n="f_badge">وسم المنتج</label>
          <select id="f_badge">
            <option value="new" data-i18n="badge_new">جديد</option>
            <option value="best" data-i18n="badge_best">الأكثر مبيعاً</option>
            <option value="pro" data-i18n="badge_pro">احترافي</option>
          </select>
        </div>

        <div class="grid-2">
          <div class="field"><label data-i18n="f_img">رابط الصورة</label><input id="f_img" placeholder="https://..." /></div>
          <div class="field"><label data-i18n="f_video">رابط الفيديو (YouTube Embed)</label><input id="f_video" placeholder="https://www.youtube.com/embed/..." /></div>
        </div>

        <div class="grid-2">
          <div class="field"><label data-i18n="f_software">رابط السوفت وير</label><input id="f_software" placeholder="https://..." /></div>
          <div class="field"><label data-i18n="f_catalog">رابط الكاتالوج</label><input id="f_catalog" placeholder="https://..." /></div>
        </div>

        <div class="field"><label data-i18n="f_features">المواصفات (كل سطر ميزة)</label><textarea id="f_features" placeholder="شحن سريع 7kW&#10;IP65&#10;حماية متعددة"></textarea></div>

        <div class="grid-2">
          <button class="btn btn-primary" id="saveBtn"><i class="fa-solid fa-floppy-disk"></i> <span data-i18n="admin_save">حفظ</span></button>
          <button class="btn btn-ghost" id="clearBtn"><i class="fa-solid fa-rotate"></i> <span data-i18n="admin_clear">تفريغ النموذج</span></button>
        </div>

        <div id="adminMsg" class="hint"></div>
      </div>

      <div class="card admin-card">
        <h3 style="margin:0 0 12px; font-weight:900" data-i18n="admin_list_title">المنتجات الحالية</h3>
        <div class="muted" style="margin-bottom:12px" data-i18n="admin_list_hint">اضغط تعديل لتحميل المنتج في النموذج.</div>
        <div class="admin-list" id="adminList"></div>
      </div>
    </div>
  </div>
</section>

<section id="faq">
  <div class="container">
    <div class="title">
      <h2 data-i18n="faq_title">الأسئلة الشائعة</h2>
      <p data-i18n="faq_sub">إجابات مختصرة قبل الشراء</p>
    </div>
    <div class="grid-2">
      <div class="card" style="padding:16px">
        <h3 style="margin:0 0 8px; font-weight:900" data-i18n="faq_q1">هل الشاحن مناسب للاستخدام اليومي؟</h3>
        <p class="muted" data-i18n="faq_a1">نعم، مصمم ليعمل بثبات مع حماية متعددة ويتيح جدولة الشحن وواجهة استخدام سهلة.</p>
      </div>
      <div class="card" style="padding:16px">
        <h3 style="margin:0 0 8px; font-weight:900" data-i18n="faq_q2">هل يدعم الشاحن الجدولة والواجهة؟</h3>
        <p class="muted" data-i18n="faq_a2">نعم للجميع — الواجهة وجدولة الشحن متاحة في كل الإصدارات.</p>
      </div>
    </div>
  </div>
</section>

<footer id="contact">
  <div class="container">
    <div class="foot">
      <div>
        <h3>XCharger</h3>
        <p class="muted" style="color:#cbd5e1" data-i18n="foot_about">حلول شحن للمركبات الكهربائية مصممة في الأردن بجودة واعتمادية.</p>
        <div class="social" style="margin-top:12px">
          <a class="iconbtn" href="#" aria-label="facebook"><i class="fa-brands fa-facebook-f"></i></a>
          <a class="iconbtn" href="#" aria-label="instagram"><i class="fa-brands fa-instagram"></i></a>
          <a class="iconbtn" href="https://wa.me/962790781206" target="_blank" rel="noopener" aria-label="whatsapp"><i class="fa-brands fa-whatsapp"></i></a>
          <a class="iconbtn" href="tel:0790781206" aria-label="phone"><i class="fa-solid fa-phone"></i></a>
          <a class="iconbtn" href="https://maps.google.com/?q=Amman%2C%20Jordan" target="_blank" rel="noopener" aria-label="map"><i class="fa-solid fa-location-dot"></i></a>
        </div>
      </div>

      <div>
        <h4 data-i18n="foot_links">روابط</h4>
        <p><a href="#products" style="text-decoration:none;color:#cbd5e1" data-i18n="nav_products">المنتجات</a></p>
        <p><a href="#compare" style="text-decoration:none;color:#cbd5e1" data-i18n="nav_compare">المقارنة</a></p>
        <p><a href="#faq" style="text-decoration:none;color:#cbd5e1" data-i18n="nav_faq">الأسئلة</a></p>
      </div>

      <div>
        <h4 data-i18n="foot_contact">تواصل معنا</h4>
        <p><i class="fa-solid fa-location-dot"></i> <span data-i18n="foot_addr">عمّان - الأردن</span></p>
        <p><i class="fa-solid fa-phone"></i> 0790781206</p>
        <p><i class="fa-solid fa-envelope"></i> <a href="mailto:info@xcharger.com" style="color:#cbd5e1;text-decoration:none">info@xcharger.com</a></p>
      </div>
    </div>

    <div class="copy">© <span id="year"></span> XCharger</div>
  </div>
</footer>

<div class="modal" id="loginModal" aria-hidden="true">
  <div class="modal-inner">
    <div class="modal-head">
      <h3 data-i18n="login_title">تسجيل الدخول</h3>
      <button class="x" id="closeModal" aria-label="close">×</button>
    </div>

    <div class="field" style="margin-top:10px">
      <label data-i18n="login_email">البريد الإلكتروني</label>
      <input id="loginEmail" type="email" placeholder="example@domain.com">
    </div>

    <div class="field">
      <label data-i18n="login_pass">كلمة المرور</label>
      <input id="loginPass" type="password" placeholder="********">
    </div>

    <button class="btn btn-primary" id="doLogin" style="width:100%; justify-content:center"><i class="fa-solid fa-lock"></i> <span data-i18n="login_do">دخول</span></button>
    <div id="loginMsg" class="hint"></div>
    <div id="roleHint" class="hint" data-i18n="role_hint">أنت مسجّل دخول لكن دورك ليس Admin. اجعل role="admin" داخل Firestore → users/{uid}.</div>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
  import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged, setPersistence, browserLocalPersistence } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";
  import { getFirestore, collection, addDoc, doc, getDoc, updateDoc, deleteDoc, onSnapshot, query, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

  const firebaseConfig = {'apiKey': 'AIzaSyAK4E04TdC_OERPQmvxlKFs_qFSmVwMuiI', 'authDomain': 'xcharger-5bb95.firebaseapp.com', 'projectId': 'xcharger-5bb95', 'storageBucket': 'xcharger-5bb95.firebasestorage.app', 'messagingSenderId': '570288654795', 'appId': '1:570288654795:web:94ecb2b696a0da7f408e4e', 'measurementId': 'G-Q9ZX3HYVQV'};

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  try { await setPersistence(auth, browserLocalPersistence); } catch(e) {}

  let LANG = "ar";
  let ROLE = "retail";
  let USER = null;
  let PRODUCTS = [];
  let EDITING_ID = null;

  const $ = (id)=>document.getElementById(id);

  const i18n = {
    ar: {
      nav_home:"الرئيسية", nav_products:"المنتجات", nav_compare:"المقارنة", nav_faq:"الأسئلة", nav_contact:"اتصل بنا",
      login_btn:"تسجيل الدخول", logout_btn:"تسجيل خروج", admin_nav:"لوحة الإدارة",
      hero_title:"طاقة المستقبل بين يديك", hero_sub:"نصمم وننتج شواحن ذكية تجمع بين الأمان وسهولة الاستخدام مع إصدارات متعددة تناسب احتياجاتك.",
      hero_cta1:"اكتشف منتجاتنا", hero_cta2:"طلب خاص",
      stat_1:"ضمان", stat_2:"دعم فني", stat_3:"أمان واعتمادية", stat_4_title:"تحكم ذكي مرن", stat_4:"تجربة استخدام سهلة",
      products_title:"إصدارات XCharger المتطورة", products_sub:"تظهر المنتجات تلقائيًا من Firebase Firestore",
      products_empty:"لا يوجد منتجات بعد. سيتم عرضها هنا عند إضافتها من لوحة الإدارة.",
      compare_title:"مقارنة الإصدارات", compare_sub:"جدول يوضح أهم الفروقات بين الإصدارات",
      admin_title:"لوحة تحكم المدير", admin_sub:"إضافة/تعديل/حذف المنتجات مباشرة على Firestore",
      admin_form_title:"بيانات المنتج", admin_form_hint:"املأ الحقول ثم اضغط حفظ.",
      admin_save:"حفظ", admin_clear:"تفريغ النموذج", admin_list_title:"المنتجات الحالية", admin_list_hint:"اضغط تعديل لتحميل المنتج في النموذج.",
      f_name:"اسم المنتج", f_price_jod_retail:"سعر المفرق (JOD)", f_price_jod_trade:"سعر التاجر (JOD)", f_price_usd_retail:"سعر المفرق (USD)", f_price_usd_trade:"سعر التاجر (USD)",
      f_badge:"وسم المنتج", badge_new:"جديد", badge_best:"الأكثر مبيعاً", badge_pro:"احترافي",
      f_img:"رابط الصورة", f_video:"رابط الفيديو (YouTube Embed)", f_software:"رابط السوفت وير", f_catalog:"رابط الكاتالوج",
      f_features:"المواصفات (كل سطر ميزة)",
      faq_title:"الأسئلة الشائعة", faq_sub:"إجابات مختصرة قبل الشراء",
      faq_q1:"هل الشاحن مناسب للاستخدام اليومي؟", faq_a1:"نعم، مصمم ليعمل بثبات مع حماية متعددة ويتيح جدولة الشحن وواجهة استخدام سهلة.",
      faq_q2:"هل يدعم الشاحن الجدولة والواجهة؟", faq_a2:"نعم للجميع — الواجهة وجدولة الشحن متاحة في كل الإصدارات.",
      foot_about:"حلول شحن للمركبات الكهربائية مصممة في الأردن بجودة واعتمادية.",
      foot_links:"روابط", foot_contact:"تواصل معنا", foot_addr:"عمّان - الأردن",
      login_title:"تسجيل الدخول", login_email:"البريد الإلكتروني", login_pass:"كلمة المرور", login_do:"دخول",
      role_hint:'أنت مسجّل دخول لكن دورك ليس Admin. اجعل role="admin" داخل Firestore → users/{uid}.',
      btn_sw:"السوفت وير", btn_cat:"الكاتالوج", btn_vid:"شرح", btn_order:"اطلب الآن",
      admin_edit:"تعديل", admin_delete:"حذف", saved_ok:"تم الحفظ بنجاح ✅", deleted_ok:"تم الحذف ✅"
    },
    en: {
      nav_home:"Home", nav_products:"Products", nav_compare:"Compare", nav_faq:"FAQ", nav_contact:"Contact",
      login_btn:"Sign in", logout_btn:"Sign out", admin_nav:"Admin",
      hero_title:"Future power in your hands", hero_sub:"We design and manufacture smart EV chargers combining safety and ease of use, with multiple editions for different needs.",
      hero_cta1:"Explore products", hero_cta2:"Custom request",
      stat_1:"Warranty", stat_2:"Support", stat_3:"Safety", stat_4_title:"Flexible smart control", stat_4:"Easy experience",
      products_title:"XCharger editions", products_sub:"Products are loaded live from Firebase Firestore",
      products_empty:"No products yet. Add the first product from the Admin panel.",
      compare_title:"Compare editions", compare_sub:"Key differences at a glance",
      admin_title:"Admin Panel", admin_sub:"Create / update / delete products on Firestore",
      admin_form_title:"Product data", admin_form_hint:"Fill the fields then click Save.",
      admin_save:"Save", admin_clear:"Reset", admin_list_title:"Existing products", admin_list_hint:"Click Edit to load into the form.",
      f_name:"Product name", f_price_jod_retail:"Retail (JOD)", f_price_jod_trade:"Trade (JOD)", f_price_usd_retail:"Retail (USD)", f_price_usd_trade:"Trade (USD)",
      f_badge:"Badge", badge_new:"New", badge_best:"Best seller", badge_pro:"Pro",
      f_img:"Image URL", f_video:"Video URL (Embed)", f_software:"Software URL", f_catalog:"Catalog URL",
      f_features:"Specs (one per line)",
      faq_title:"FAQ", faq_sub:"Quick answers before buying",
      faq_q1:"Is it suitable for daily use?", faq_a1:"Yes, built for stability with multiple protections, scheduling and an easy interface.",
      faq_q2:"Does it support scheduling and interface?", faq_a2:"Yes for all editions — scheduling and interface are included.",
      foot_about:"EV charging solutions designed in Jordan with quality and reliability.",
      foot_links:"Links", foot_contact:"Contact", foot_addr:"Amman, Jordan",
      login_title:"Sign in", login_email:"Email", login_pass:"Password", login_do:"Sign in",
      role_hint:'You are signed in but not Admin. Set role="admin" in Firestore → users/{uid}.',
      btn_sw:"Software", btn_cat:"Catalog", btn_vid:"Video", btn_order:"Order",
      admin_edit:"Edit", admin_delete:"Delete", saved_ok:"Saved ✅", deleted_ok:"Deleted ✅"
    }
  };

  function applyLang() {
    document.documentElement.lang = LANG;
    document.documentElement.dir = (LANG==="ar") ? "rtl" : "ltr";
    $("langAR").classList.toggle("active", LANG==="ar");
    $("langEN").classList.toggle("active", LANG==="en");

    document.querySelectorAll("[data-i18n]").forEach(el=>{
      const k = el.getAttribute("data-i18n");
      const v = i18n[LANG][k];
      if (typeof v === "string") el.textContent = v;
    });

    renderProducts();
    renderCompare();
  }

  function fmtPrice(p) {
    if (p === null || p === undefined || p === "") return "";
    const n = Number(p);
    if (Number.isNaN(n)) return String(p);
    return (LANG==="ar") ? (n.toFixed(0) + " د.أ") : ("$" + n.toFixed(0));
  }

  function badgeText(b) {
    const map = {
      new: (LANG==="ar" ? "جديد" : "New"),
      best: (LANG==="ar" ? "الأكثر مبيعاً" : "Best"),
      pro: (LANG==="ar" ? "احترافي" : "Pro"),
    };
    return map[b] || "";
  }

  function showHint(el, msg, ok=true) {
    if (!el) return;
    el.style.display = "block";
    el.style.color = ok ? "#166534" : "#b91c1c";
    el.textContent = msg;
    setTimeout(()=>{ el.style.display="none"; }, 2600);
  }

  function escapeHtml(s) {
    return s.replace(/[&<>"']/g, (c)=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[c]));
  }

  // Modal
  function openModal() {
    $("loginModal").style.display = "block";
    $("loginMsg").style.display = "none";
    $("roleHint").style.display = "none";
  }
  function closeModal() {
    $("loginModal").style.display = "none";
  }

  $("loginBtn").addEventListener("click", openModal);
  $("closeModal").addEventListener("click", closeModal);
  $("loginModal").addEventListener("click", (e)=>{ if (e.target.id==="loginModal") closeModal(); });

  async function doLogin() {
    const email = $("loginEmail").value.trim();
    const pass  = $("loginPass").value;
    $("loginMsg").style.display="none";
    try {
      await signInWithEmailAndPassword(auth, email, pass);
      closeModal();
    } catch (e) {
      $("loginMsg").style.display="block";
      $("loginMsg").textContent = (LANG==="ar") ? ("فشل الدخول: " + (e.code||"")) : ("Login failed: " + (e.code||""));
    }
  }
  $("doLogin").addEventListener("click", doLogin);

  $("logoutBtn").addEventListener("click", async ()=>{ await signOut(auth); });

  async function loadRole(uid) {
    ROLE = "retail";
    try {
      const snap = await getDoc(doc(db,"users",uid));
      if (snap.exists() && snap.data()?.role) ROLE = String(snap.data().role);
    } catch(e) {}
  }

  function isAdmin() { return ROLE === "admin"; }

  function updateHeader() {
    if (USER) {
      $("userPill").style.display="inline-flex";
      $("userText").textContent = (USER.email||USER.uid) + " • " + ROLE.toUpperCase();
      $("loginBtn").style.display="none";
      $("logoutBtn").style.display="inline-flex";
    } else {
      $("userPill").style.display="none";
      $("loginBtn").style.display="inline-flex";
      $("logoutBtn").style.display="none";
      $("adminNavBtn").style.display="none";
      $("adminPanel").style.display="none";
    }
  }

  function toggleAdminUI() {
    $("adminPanel").style.display = isAdmin() ? "block" : "none";
    $("adminNavBtn").style.display = isAdmin() ? "inline-flex" : "none";
  }

  $("adminNavBtn").addEventListener("click", ()=>{ $("adminPanel").scrollIntoView({behavior:"smooth"}); });

  // Products
  function renderProducts() {
    const grid = $("productsGrid");
    grid.innerHTML = "";
    $("productsEmpty").style.display = PRODUCTS.length ? "none" : "block";

    PRODUCTS.forEach(p=>{
      const img = p.image || "https://images.unsplash.com/photo-1593941707882-a5bba14938c7?auto=format&fit=crop&w=600&q=80";
      const feats = Array.isArray(p.features) ? p.features : [];
      const price = (LANG==="ar") ? p.price_jod_retail : p.price_usd_retail;

      const card = document.createElement("div");
      card.className = "card p-card";
      card.innerHTML = `
        <div class="p-top">
          <div class="p-img"><img src="${img}" alt=""></div>
          <div style="flex:1">
            <div class="p-badge">${badgeText(p.badge)} </div>
            <h3 class="p-name">${escapeHtml(p.name||"")}</h3>
            <div class="p-price">${fmtPrice(price)}</div>
            <div class="muted" style="margin-top:4px">${LANG==="ar" ? "عمّان - الأردن" : "Amman, Jordan"}</div>
          </div>
        </div>
        <ul class="feat">
          ${feats.slice(0,6).map(f=>`<li><i class="fa-solid fa-circle-check"></i> ${escapeHtml(String(f).trim())}</li>`).join("")}
        </ul>
        <div class="p-actions">
          <a class="btn btn-ghost" href="${p.software||"#"}" target="_blank" rel="noopener"><i class="fa-solid fa-download"></i> ${i18n[LANG].btn_sw}</a>
          <a class="btn btn-ghost" href="${p.catalog||"#"}" target="_blank" rel="noopener"><i class="fa-regular fa-file-pdf"></i> ${i18n[LANG].btn_cat}</a>
          <a class="btn btn-ghost" href="${p.video||"#"}" target="_blank" rel="noopener"><i class="fa-solid fa-play"></i> ${i18n[LANG].btn_vid}</a>
          <button class="btn btn-primary" style="margin-inline-start:auto" onclick="window.__order('${escapeHtml(p.name||"")}', '${fmtPrice(price)}')"><i class="fa-solid fa-cart-shopping"></i> ${i18n[LANG].btn_order}</button>
        </div>
      `;
      grid.appendChild(card);
    });
  }

  function renderCompare() {
    const tbl = $("compareTable");
    const cols = PRODUCTS.slice(0,4);
    const rows = [
      { ar:"قدرة الشحن", en:"Charging power", get:(p)=>p.power||"7 kW" },
      { ar:"الحماية", en:"Protection", get:(p)=>p.protection||"IP65" },
      { ar:"واجهة نعم للجميع", en:"Interface (Yes for all)", get:(p)=>"✓" },
      { ar:"جدولة الشحن نعم للجميع", en:"Scheduling (Yes for all)", get:(p)=>"✓" },
      { ar:"ريموت تحكم", en:"Remote unit", get:(p)=> p.remote ? "✓" : "—" },
      { ar:"أوامر صوتية", en:"Voice control", get:(p)=> p.voice ? "✓" : "—" },
    ];

    const head = `
      <thead>
        <tr>
          <th>${LANG==="ar" ? "الميزة" : "Feature"}</th>
          ${cols.map(p=>`<th>${escapeHtml(p.name||"")}<br><small>${fmtPrice(LANG==="ar"?p.price_jod_retail:p.price_usd_retail)}</small></th>`).join("")}
        </tr>
      </thead>
    `;
    const body = `
      <tbody>
        ${rows.map(r=>`<tr>
          <td>${LANG==="ar" ? r.ar : r.en}</td>
          ${cols.map(p=>`<td>${escapeHtml(String(r.get(p)))}</td>`).join("")}
        </tr>`).join("")}
      </tbody>
    `;
    tbl.innerHTML = head + body;
  }

  window.__order = (name, price)=>{
    alert((LANG==="ar" ? "تمت إضافة المنتج:\n" : "Added to cart:\n") + name + "\n" + price);
  };

  // Live products subscription
  const qy = query(collection(db,"products"), orderBy("createdAt","desc"));
  onSnapshot(qy, (snap)=>{
    PRODUCTS = snap.docs.map(d=>({ id:d.id, ...d.data() }));
    renderProducts();
    renderCompare();
    renderAdminList();
  }, (err)=>{ console.error("Firestore snapshot error:", err); });

  // Admin CRUD
  function numOrNull(v) {
    const n = Number(v);
    return Number.isFinite(n) ? n : null;
  }

  function getFormData() {
    const features = $("f_features").value.split("\n").map(s=>s.trim()).filter(Boolean);
    return {
      name: $("f_name").value.trim(),
      badge: $("f_badge").value,
      image: $("f_img").value.trim(),
      video: $("f_video").value.trim(),
      software: $("f_software").value.trim(),
      catalog: $("f_catalog").value.trim(),
      features,
      price_jod_retail: numOrNull($("f_price_jod_retail").value),
      price_jod_trade:  numOrNull($("f_price_jod_trade").value),
      price_usd_retail: numOrNull($("f_price_usd_retail").value),
      price_usd_trade:  numOrNull($("f_price_usd_trade").value),
      remote: /ريموت|remote/i.test(features.join(" ")) ? true : undefined,
      voice: /صوت|voice/i.test(features.join(" ")) ? true : undefined,
    };
  }

  function clearForm() {
    EDITING_ID = null;
    ["f_name","f_img","f_video","f_software","f_catalog","f_features","f_price_jod_retail","f_price_jod_trade","f_price_usd_retail","f_price_usd_trade"].forEach(id=>$(id).value="");
    $("f_badge").value="new";
  }

  $("clearBtn").addEventListener("click", clearForm);

  $("saveBtn").addEventListener("click", async ()=>{
    const msgEl = $("adminMsg");
    msgEl.style.display="none";

    if (!isAdmin()) {
      showHint(msgEl, (LANG==="ar" ? "غير مصرح: Admin فقط" : "Not allowed: Admin only"), false);
      return;
    }

    const data = getFormData();
    if (!data.name) {
      showHint(msgEl, (LANG==="ar" ? "يرجى إدخال اسم المنتج" : "Please enter a product name"), false);
      return;
    }

    try {
      if (EDITING_ID) {
        await updateDoc(doc(db,"products",EDITING_ID), {...data, updatedAt: serverTimestamp()});
      } else {
        await addDoc(collection(db,"products"), {...data, createdAt: serverTimestamp()});
      }
      showHint(msgEl, i18n[LANG].saved_ok, true);
      clearForm();
    } catch(e) {
      console.error("Save error:", e);
      showHint(msgEl, (LANG==="ar" ? "فشل الحفظ: " : "Save failed: ") + (e.code||""), false);
    }
  });

  function renderAdminList() {
    const list = $("adminList");
    list.innerHTML = "";

    if (!isAdmin()) {
      list.innerHTML = `<div class="muted">${LANG==="ar" ? "لوحة الإدارة للأدمن فقط." : "Admin only."}</div>`;
      return;
    }

    PRODUCTS.forEach(p=>{
      const it = document.createElement("div");
      it.className = "item";
      it.innerHTML = `
        <div class="meta">
          <b>${escapeHtml(p.name||"")}</b>
          <span>${fmtPrice(LANG==="ar"?p.price_jod_retail:p.price_usd_retail)} • id: ${p.id}</span>
        </div>
        <div class="row">
          <button class="btn btn-ghost" data-act="edit"><i class="fa-regular fa-pen-to-square"></i> ${i18n[LANG].admin_edit}</button>
          <button class="btn btn-ghost danger" data-act="del"><i class="fa-regular fa-trash-can"></i> ${i18n[LANG].admin_delete}</button>
        </div>
      `;
      it.querySelector('[data-act="edit"]').addEventListener("click", ()=>loadToForm(p));
      it.querySelector('[data-act="del"]').addEventListener("click", ()=>delProduct(p.id));
      list.appendChild(it);
    });
  }

  function loadToForm(p) {
    EDITING_ID = p.id;
    $("f_name").value = p.name||"";
    $("f_badge").value = p.badge||"new";
    $("f_img").value = p.image||"";
    $("f_video").value = p.video||"";
    $("f_software").value = p.software||"";
    $("f_catalog").value = p.catalog||"";
    $("f_features").value = (Array.isArray(p.features)?p.features:[]).join("\n");
    $("f_price_jod_retail").value = p.price_jod_retail ?? "";
    $("f_price_jod_trade").value  = p.price_jod_trade ?? "";
    $("f_price_usd_retail").value = p.price_usd_retail ?? "";
    $("f_price_usd_trade").value  = p.price_usd_trade ?? "";
    $("adminPanel").scrollIntoView({behavior:"smooth"});
  }

  async function delProduct(id) {
    if (!isAdmin()) return;
    const ok = confirm(LANG==="ar" ? "هل تريد حذف المنتج؟" : "Delete product?");
    if (!ok) return;
    const msgEl = $("adminMsg");
    try {
      await deleteDoc(doc(db,"products",id));
      showHint(msgEl, i18n[LANG].deleted_ok, true);
      if (EDITING_ID===id) clearForm();
    } catch(e) {
      console.error("Delete error:", e);
      showHint(msgEl, (LANG==="ar" ? "فشل الحذف: " : "Delete failed: ") + (e.code||""), false);
    }
  }

  onAuthStateChanged(auth, async (u)=>{
    USER = u || null;
    if (USER) {
      await loadRole(USER.uid);
    } else {
      ROLE = "retail";
    }
    updateHeader();
    toggleAdminUI();
    renderAdminList();
    // if logged in but not admin, show hint inside modal if opened
  });

  $("langAR").addEventListener("click", ()=>{ LANG="ar"; applyLang(); });
  $("langEN").addEventListener("click", ()=>{ LANG="en"; applyLang(); });

  $("year").textContent = new Date().getFullYear();
  applyLang();
</script>

</body>
</html>
